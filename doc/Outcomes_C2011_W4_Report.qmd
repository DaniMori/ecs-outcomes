---
title: "Workload estimation"
author: "Daniel Morillo"
format:
  docx:
    table-of-contents: true
    self-contained:    true
    fig-width:          7.75
    fig-height:         4.25
    df-print:          kable
knitr:
  opts_chunk:
    echo:    false
    error:   false
    warning: false
    message: false
---

```{r setup}
library(knitr)
library(patchwork)
library(gtsummary)
```

```{r source}
read_chunk("../src/C2011_W4_Planning.R")
```

```{r main}
```

# Planning

The total number of outcomes assigned to each team member is shown in
@fig-num-outcomes-output. From left to right, the figure shows the datasets
assigned to be coded by each member, reviewed by each member, and the sum of
both. The same information can be seen in @fig-coding-date disaggregated by due
date.

```{r num-outcomes}
```

```{r num-outcomes-output}
#| label:   fig-num-outcomes-output
#| fig-cap: Number of outcome datasets by team member
coding_load <- coding_load + ggtitle("coded")
review_load <- review_load + ggtitle("reviewed")
total_load  <- total_load  + ggtitle("total (code + reviewed)")

coding_load + review_load + total_load
```

```{r coding-date}
#| label:   fig-coding-date
#| fig-cap: Number of outcome datasets by team member and due date
#| fig-height: 8.5
coding_date <- coding_date + ggtitle("coded")    + guides(color = guide_none())
review_date <- review_date + ggtitle("reviewed") + guides(color = guide_none())
total_date  <- total_date            +
  ggtitle("total (code + reviewed)") +
  guides(color = guide_legend(title = NULL, direction = "horizontal")) +
  theme(legend.position = "bottom")

coding_date / review_date / total_date
```

# Completion

```{r}
completion_data <- planning_data  |>
  select(
    SECTION:`VARIABLE (s)`,
    `Due date` = `DUE DATE...16`,
    Complete   = COMPLETE...17,
    Incidence  = REMARKS
  ) |>
  rename_with(str_to_sentence) |>
  mutate(Complete = Complete |> coalesce("No") |> str_to_sentence())

n_datasets_total    <- completion_data |> nrow()
n_datasets_complete <- completion_data |>
  filter(Complete == "Yes") |>
  nrow()

incomplete_datasets <- completion_data |>
  filter(Complete == "No") |>
  select(Section:`Variable (s)`, Incidence)
```

There were `r n_datasets_total` datasets planned to be coded. Out of them,
`r n_datasets_complete` have been successfully coded (see @tab-completion-out).
However, some datasets have been found to be dependent on non-existent outcomes
from previous waves. That means that some variables could not be created because
the variables they depend on have not been created in previous waves, either.
These are reported in @tbl-dependent-detail-out. Also, the details of the
datasets that have not been coded are shown in @tbl-incomplete-detail-out.

```{r dependent-detail-out}
#| label:   tbl-dependent-detail-out
#| tbl-cap: |
#|   Detail of complete datasets that have had incidences due to being dependent
#|   on non-existing variables in previous waves.
completion_data |>
  filter(Incidence == '"Lifetime" needs to be created') |>
  select(-`Due date`, -Complete)
```

```{r incomplete-detail-out}
#| label:   tbl-incomplete-detail-out
#| tbl-cap: Detail of the incomplete datasets.
incomplete_datasets
```

