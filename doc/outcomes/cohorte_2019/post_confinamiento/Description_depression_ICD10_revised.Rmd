---
title: "Edad con Salud -- cohort 2019 -- COVID substudy -- 'Depression ICD10 REVISED'"
output:
  word_document:
    reference_docx: !expr ecs.data::get_pkg_docx_template()
#bibliography: "`r ecs.data::get_proj_bib_file()`"
csl: "`r ecs.data::get_proj_csl_file()`"
# nocite: '@<cita_1>, @<cita_2>' ## TODO: Descomentar y aÃ±adir cita(s) o borrar campo
---

```{r setup, include=FALSE}
# Activar los paquetes que R necesita para ejecutar el cÃ³digo:

library(Statamarkdown)

# Ruta al ejecutable de Stata (Ejecuta `sysdir` en Stata para encontrar la ruta)

STATA_PATH <- r"(C:/Program Files (x86)/Stata15/StataSE-64.exe)"


# Opciones de configuraciÃ³n de las salidas de R y Stata:

options(width = 88) # Ancho de salida de texto en R

knitr::opts_chunk$set( # Para todos los 'chunks' de cÃ³digo:
  engine.path = list(stata = STATA_PATH),
  echo        = FALSE, #   - No muestra la sintaxis en el documento
  results     = 'hide',#   - Omite los resultados de ejecutar la sintaxis
  cleanlog    = TRUE,  #   - Omite repetir sintaxis en resultados de Stata
  collectcode = TRUE,  #   - Reutiliza el cÃ³digo de Stata de 'chunks' anteriores
  comment     = ''     #   - No aÃ±ade ningÃºn prefijo a los resultados
)
```

# Variable information

+------------------------+-------------------------------------------------------+------------+---------------------------------+
| **Main variable name** | **Label**                                             | **Format** | **Code**                        | 
+:=======================+:======================================================+:===========+:================================+
| depression_30d         | 30 days depression (c2019_wCOVID)                     | Binary     | 0=No;1=Yes                      |
+------------------------+-------------------------------------------------------+------------+---------------------------------+
| d_30d_severity         | Severity of 30 days depressive episode (c2019_wCOVID) | Ordinal    | 0=No;1=Mild;2=Moderate;3=Severe |
+------------------------+-------------------------------------------------------+------------+---------------------------------+

# Variable description
  
Depression has become a major public health issue as it is one of the main causes of disability worldwide, with an even greater impact on developed countries. According to The ICD-10 Classification of Mental and Behavioural Disorders, Diagnostic criteria for research (World Health Organization, 1993), the main characteristics of depression are the presence of a sustained depressed mood, the loss of interest or pleasure in activities normally pleasurable and/or the decreased energy or increased fatigability. In addition to these main criteria, the ICD-10 Diagnostic criteria for research proposes several contributing factors that can be present or absent: loss of confidence and self-esteem, feelings of self-reproach or guilt, recurrent thoughts of death or suicide, diminished ability to think or concentrate, change in psychomotor activity, sleep disturbance, and changes in appetite with the corresponding weight change. Moreover, the classification proposes a three-level gradient of severity depending on the amount of criteria present in each case, from mild to severe. In order to address these criteria and be able to assess the lifetime presence or absence of a depressive episode, as well as its severity, we used an adapted version of the Composite International Diagnostic Interview (CIDI 3.0), a comprehensive, fully-structured interview designed to be used by trained lay interviewers for the assessment of mental disorders according to the definitions and criteria of ICD-10. It is intended for use in epidemiological and cross-cultural studies, as well as for clinical and research purposes.
 
# Explanation of how the variables were created

Information from the CIDI depression module was used for the creation of the depression variables. Algorithms based on the ICD-10 were used for the endorsement of depressive episode in the previous 30 days (point prevalence). We also included a severity variable, according to the ICD-10 criteria.

Se muestra una comparación entre la sintaxis original y la revisada, motivada por errores detectados en otras variables de depresión.

# Syntax used to create the variable (Stata 13)

```{stata load-data}

* Cohorte 2019, ola postconfinamiento:
use "~\UAM\marta.miret@uam.es - Bases de datos maestras Edad con Salud\Subestudio_COVID\Edad_con_salud_Fichero_Completo.dta"

```

```{stata generate-outcomes, echo=TRUE}

*Previous recoding of the symptomatology questions 
* Original
* Nota. En el algoritmo original, las preguntas de sintomatología se recodifican como 0/1 (o “missing”). Dado que los “DK”/“Refuse” se deben considerar como “ausencia de síntoma” es necesario tratarlos como “0”. Dado que el tratamiento es diferente entre el algoritmo original y el revisado, se crean nuevas variables con el sufijo _alt para el algoritmo original y así evitar sobreescribir sus valores.

gen SM8_1_alt=SM8_1
gen SM8_2_alt=SM8_2
gen SM8_3_alt=SM8_3
gen SM8_4_alt=SM8_4
gen SM8_5_alt=SM8_5
gen SM8_6_alt=SM8_6
gen SM8_7_alt=SM8_7
gen SM8_8_alt=SM8_8
gen SM8_9_alt=SM8_9
gen SM8_10_alt= SM8_10       
recode SM8_1_alt-SM8_10_alt (1=1) (999 =.) (2=0)

* Revisión
recode SM8_1-SM8_10 (2=0)

***Depressive episode (F32)

*A criterion: "The general criteria for depressive episode must be met"
* There is only information for G1.
*G1 criterion: "The depressive episode should last for at least 2 weeks"

* Original
gen d_crit_g1_org = .
replace d_crit_g1_org = 0 if SM4!=1
replace d_crit_g1_org = 1 if SM4==1
label variable d_crit_g1_org "G1 criterion for depression"

* Revisión
gen d_crit_g1 = SM4==1
replace d_crit_g1 = . if SM4==. 
label variable d_crit_g1 "G1 criterion for depression"

tab d_crit_g1_org d_crit_g1, mis

        G1 |
 criterion |
       for |   G1 criterion for depression
depression |         0          1          . |     Total
-----------+---------------------------------+----------
         0 |       186          0      1,541 |     1,727 
         1 |         0        127          0 |       127 
-----------+---------------------------------+----------
     Total |       186        127      1,541 |     1,854 

	 * 1541 perdidos se codifican como "0" en el algoritmo original.  

* Original
gen d_crit_a_org = .
replace d_crit_a_org = 0 if d_crit_g1!=1
replace d_crit_a_org = 1 if d_crit_g1==1
label variable d_crit_a_org "A criterion for depression"

* Revisión
gen d_crit_a = d_crit_g1==1
replace d_crit_a = . if d_crit_g1==.
label variable d_crit_a "A criterion for depression"

tab d_crit_a_org d_crit_a, mis

         A |
 criterion |
       for |    A criterion for depression
depression |         0          1          . |     Total
-----------+---------------------------------+----------
         0 |       186          0      1,541 |     1,727 
         1 |         0        127          0 |       127 
-----------+---------------------------------+----------
     Total |       186        127      1,541 |     1,854 

	 * 1541 perdidos se codifican como "0" en el algoritmo original.
	 
*B criterion: "At least two of the following three symptoms must be present"

*B1: "Depressed mood to a degree that is definitely abnormal for the individual, present for most of the day and almost every day, largely uninfluenced by circumstances, and sustained for at least 2 weeks".
* Original
gen d_b1_org = 0
replace d_b1_org = 1 if SM4==1 
replace d_b1_org = . if SM4==. 
label variable d_b1_org "B1 criterion for depression"

* Revisión
* Nota. En esta ocasión solo preguntamos por ánimo depresivo en las preguntas de screening. Por eso, en lugar de fijarnos únicamente en la duración del síntoma, hemos forzado al programa para que el ánimo depresivo sea un síntoma presente.

gen d_b1 = SM_1==1 & SM4==1
replace d_b1 = . if SM_1==. & SM4==.
label variable d_b1 "B1 criterion for depression"

tab d_b1_org d_b1, mis

        B1 |
 criterion |
       for |   B1 criterion for depression
depression |         0          1          . |     Total
-----------+---------------------------------+----------
         0 |       186          0          0 |       186 
         1 |        18        109          0 |       127 
         . |       805          0        736 |     1,541 
-----------+---------------------------------+----------
     Total |     1,009        109        736 |     1,854 

* 805 "0" son perdidos en el algoritmo original y 18 "0" son "1" en el algoritmo original. 
* Los 805 participantes no reportan ningún síntoma clave y, por tanto, no responden SM4. Los 18 casos se corresponden con personas que sí reportaron síntomas durante al menos dos semanas pero no relacionado con ánimo depresivo. 

*B2: "Loss of interest or pleasure in activities that are normally pleasurable"
* Original
gen d_b2_org = 0
replace d_b2_org = 1 if SM_3==1 
replace d_b2_org = . if SM_3==.
label variable d_b2_org "B2 criterion for depression"

* Revisión
gen d_b2 = 0
replace d_b2 = 1 if SM_3==1 
replace d_b2 = . if SM_3==.
label variable d_b2 "B2 criterion for depression"

tab d_b2_org d_b2, mis

        B2 |
 criterion |
       for |   B2 criterion for depression
depression |         0          1          . |     Total
-----------+---------------------------------+----------
         0 |       957          0          0 |       957 
         1 |         0        161          0 |       161 
         . |         0          0        736 |       736 
-----------+---------------------------------+----------
     Total |       957        161        736 |     1,854 

	 * No se observan diferencias

*B3: "Decreased energy or increased fatigability"
* Original
gen d_b3_org = 0
replace d_b3_org = 1 if SM8_6_alt==1
replace d_b3_org = . if SM8_6_alt==.
label variable d_b3_org "B3 criterion for depression"

* Revisión
gen d_b3 = SM8_6==1
replace d_b3 = . if SM8_6==.
label variable d_b3 "B3 criterion for depression"

tab d_b3_org d_b3, mis

        B3 |
 criterion |
       for |   B3 criterion for depression
depression |         0          1          . |     Total
-----------+---------------------------------+----------
         0 |        27          0          0 |        27 
         1 |         0         99          0 |        99 
         . |         1          0      1,727 |     1,728 
-----------+---------------------------------+----------
     Total |        28         99      1,727 |     1,854 
         
	 * 1 "0" es perdido en el algoritmo original. Esto es debido a la recodificación inicial, en el que el valor 9 se transformó en perdido.

*Sum of depressive screening symptoms
* Original
*Nota. Se cambia "d_b1_org-d_b3_org" por "d_b1_org d_b2_org d_b3_org" para evitar la suma de síntomas incorrecta (estas variables no aparecen seguidas en la BBDD).
egen d_screentotal_org = rowtotal (d_b1_org d_b2_org d_b3_org)
label variable d_screentotal_org "Screening symptoms for depression"

* Revisión
egen d_screentotal = rowtotal (d_b1 d_b2 d_b3), missing
label variable d_screentotal "Screening symptoms for depression"

tab d_screentotal_org d_screentotal, mis

 Screening |
  symptoms |
       for |           Screening symptoms for depression
depression |         0          1          2          3          . |     Total
-----------+-------------------------------------------------------+----------
         0 |       925          0          0          0        736 |     1,661 
         1 |         4         71          0          0          0 |        75 
         2 |         0         10         32          0          0 |        42 
         3 |         0          0          4         72          0 |        76 
-----------+-------------------------------------------------------+----------
     Total |       929         81         36         72        736 |     1,854 

	 * 4 "0" son un "1" en el algoritmo original; 10 "1" son un "2" en el algoritmo original y 4 "2" son "3" en el algoritmo original. Estos 18 casos son distintos debido a las diferencias observadas en b1.

*To fulfil B criterion >=2 screening symptoms should be present.
* Original
gen d_crit_b_org = .
replace d_crit_b_org = 0 if d_screentotal_org<2
replace d_crit_b_org = 1 if d_screentotal_org>=2
label variable d_crit_b_org "B criterion for depression"

* Revisión
gen d_crit_b = .
replace d_crit_b = 0 if d_screentotal<2
replace d_crit_b = 1 if d_screentotal>=2 & d_screentotal!=.
label variable d_crit_b "B criterion for depression"

tab d_crit_b_org d_crit_b, mis

         B |
 criterion |
       for |    B criterion for depression
depression |         0          1          . |     Total
-----------+---------------------------------+----------
         0 |     1,000          0        736 |     1,736 
         1 |        10        108          0 |       118 
-----------+---------------------------------+----------
     Total |     1,010        108        736 |     1,854 

	 * 10 "0" son "1" en el algoritmo original. Esto se debe a las diferencias observadas en b1.

*C criterion: "An additional symptom or symptoms from the following list should be present, to give a total of at least four"

*C1: "Loss of confidence and self-esteem"
* Original
gen d_c1_org = 0
replace d_c1_org = 1 if SM8_9_alt==1
replace d_c1_org = . if SM8_9_alt==.
label variable d_c1_org "C1 criterion for depression"

* Revisión
gen d_c1 = SM8_9==1
replace d_c1 = . if SM8_9==.
label variable d_c1 "C1 criterion for depression"

tab d_c1_org d_c1, mis

        C1 |
 criterion |
       for |   C1 criterion for depression
depression |         0          1          . |     Total
-----------+---------------------------------+----------
         0 |        42          0          0 |        42 
         1 |         0         84          0 |        84 
         . |         1          0      1,727 |     1,728 
-----------+---------------------------------+----------
     Total |        43         84      1,727 |     1,854 
	 * 1 "0" es perdido en el algoritmo original. Esto es debido a la recodificación inicial, en el que el valor 9 se transformó en perdido.

*C2: "Unreasonable feelings of self-reproach or excessive and inappropriate guilt"

* Original
gen d_c2_org = 0
replace d_c2_org = 1 if SM8_7_alt==1
replace d_c2_org = . if SM8_7_alt==.
label variable d_c2_org "C2 criterion for depression"

* Revisión
gen d_c2 = SM8_7==1
replace d_c2 = . if SM8_7==.
label variable d_c2 "C2 criterion for depression"

tab d_c2_org d_c2, mis

        C2 |
 criterion |
       for |   C2 criterion for depression
depression |         0          1          . |     Total
-----------+---------------------------------+----------
         0 |        81          0          0 |        81 
         1 |         0         45          0 |        45 
         . |         1          0      1,727 |     1,728 
-----------+---------------------------------+----------
     Total |        82         45      1,727 |     1,854 
	 * 1 "0" es perdido en el algoritmo original. Esto es debido a la recodificación inicial, en el que el valor 9 se transformó en perdido.

*C3: "Recurrent thoughts of death or suicide, or any suicidal behaviour"
* Original
gen d_c3_org = 0
replace d_c3_org = 1 if SM8_10_alt==1 
replace d_c3_org = 1 if SM8_10_alt==. 
label variable d_c3_org "C3 criterion for depression"

* Revisión
gen d_c3 = SM8_10==1 
replace d_c3 = . if SM8_10==. 
label variable d_c3 "C3 criterion for depression"

tab d_c3_org d_c3, mis

        C3 |
 criterion |
       for |   C3 criterion for depression
depression |         0          1          . |     Total
-----------+---------------------------------+----------
         0 |        92          0          0 |        92 
         1 |         3         32      1,727 |     1,762 
-----------+---------------------------------+----------
     Total |        95         32      1,727 |     1,854 

	 * 3 "0" son "1" en el algoritmo original y 1727 perdidos son "1" en el algoritmo original. Por error en la sintaxis original todos los perdidos se convierten en "1".

*C4: "Complaints or evidence of diminished ability to think or concentrate, such as indecisiveness or vacillation"
* Original
gen d_c4_org = 0
replace d_c4_org = 1 if SM8_8_alt==1
replace d_c4_org = . if SM8_8_alt==. 
label variable d_c4_org "C4 criterion for depression"

* Revisión
gen d_c4 = SM8_8==1
replace d_c4 = . if SM8_8==. 
label variable d_c4 "C4 criterion for depression"

tab d_c4_org d_c4, mis

        C4 |
 criterion |
       for |   C4 criterion for depression
depression |         0          1          . |     Total
-----------+---------------------------------+----------
         0 |        47          0          0 |        47 
         1 |         0         79          0 |        79 
         . |         1          0      1,727 |     1,728 
-----------+---------------------------------+----------
     Total |        48         79      1,727 |     1,854 

	 * 1 "0" es perdido en el algoritmo original. Esto es debido a la recodificación inicial, en el que el valor 9 se transformó en perdido.

*C5: "Change in psychomotor activity, with agitation or retardation (either subjective or objective)"
* Original
gen d_c5_org = 0
replace d_c5_org = 1 if (SM8_4_alt==1) | (SM8_5_alt==1)
replace d_c5_org = . if SM8_4_alt==. & SM8_5_alt==. 
label variable d_c5_org "C5 criterion for depression"

* Revisión
gen d_c5 = (SM8_4==1) | (SM8_5==1)
replace d_c5 = . if SM8_4==. & SM8_5==. 
label variable d_c5 "C5 criterion for depression"

tab d_c5_org d_c5, mis

        C5 |
 criterion |
       for |   C5 criterion for depression
depression |         0          1          . |     Total
-----------+---------------------------------+----------
         0 |        43          0          0 |        43 
         1 |         0         83          0 |        83 
         . |         1          0      1,727 |     1,728 
-----------+---------------------------------+----------
     Total |        44         83      1,727 |     1,854 
	 
	 * 1 "0" es perdido en el algoritmo original. Esto es debido a la recodificación inicial, en el que el valor 9 se transformó en perdido.

*C6: "Sleep disturbance of any type"
* Original
gen d_c6_org = 0
replace d_c6_org = 1 if SM8_2_alt==1 | SM8_3_alt==1
replace d_c6_org = . if SM8_2_alt==. & SM8_3_alt==.
label variable d_c6_org "C6 criterion for depression"

* Revisión
gen d_c6 = SM8_2==1 | SM8_3==1
replace d_c6 = . if SM8_2==. & SM8_3==.
label variable d_c6 "C6 criterion for depression"

tab d_c6_org d_c6, mis

        C6 |
 criterion |
       for |   C6 criterion for depression
depression |         0          1          . |     Total
-----------+---------------------------------+----------
         0 |        22          0          0 |        22 
         1 |         0        104          0 |       104 
         . |         1          0      1,727 |     1,728 
-----------+---------------------------------+----------
     Total |        23        104      1,727 |     1,854 

	 * 1 "0" es perdido en el algoritmo original. Esto es debido a la recodificación inicial, en el que el valor 9 se transformó en perdido.

*C7: "Change in appetite (decrease or increase) with corresponding weight change"
* Original
gen d_c7_org = 0
replace d_c7_org = 1 if SM8_1_alt==1 
replace d_c7_org = . if SM8_1_alt==.
label variable d_c7_org "C7 criterion for depression"

* Revisión
gen d_c7 = SM8_1==1 
replace d_c7 = . if SM8_1==.
label variable d_c7 "C7 criterion for depression"

tab d_c7_org d_c7, mis

        C7 |
 criterion |
       for |   C7 criterion for depression
depression |         0          1          . |     Total
-----------+---------------------------------+----------
         0 |        40          0          0 |        40 
         1 |         0         86          0 |        86 
         . |         1          0      1,727 |     1,728 
-----------+---------------------------------+----------
     Total |        41         86      1,727 |     1,854 

	 	 * 1 "0" es perdido en el algoritmo original. Esto es debido a la recodificación inicial, en el que el valor 9 se transformó en perdido.

*Sum of depressive symptoms
* Original
*Nota. Se cambia "d_c1_org-d_c7_org" por "d_c1_org d_c2_org d_c3_org d_c4_org d_c5_org d_c6_org d_c7_org" para evitar la suma de síntomas incorrecta (estas variables no aparecen seguidas en la BBDD).
egen d_symtotal_org = rowtotal (d_c1_org d_c2_org d_c3_org d_c4_org d_c5_org d_c6_org d_c7_org)
label variable d_symtotal_org "Symptoms for depression"

* Revisión
egen d_symtotal = rowtotal (d_c1 d_c2 d_c3 d_c4 d_c5 d_c6 d_c7), missing
label variable d_symtotal "Symptoms for depression"

tab d_symtotal_org d_symtotal, mis


  Symptoms |
       for |                                      Symptoms for depression
depression |         0          1          2          3          4          5          6          7          . |     Total
-----------+---------------------------------------------------------------------------------------------------+----------
         0 |         5          0          0          0          0          0          0          0          0 |         5 
         1 |         1          5          0          0          0          0          0          0      1,727 |     1,733 
         2 |         0          0         10          0          0          0          0          0          0 |        10 
         3 |         0          0          0         28          0          0          0          0          0 |        28 
         4 |         0          0          0          1         25          0          0          0          0 |        26 
         5 |         0          0          0          0          0         21          0          0          0 |        21 
         6 |         0          0          0          0          0          1         19          0          0 |        20 
         7 |         0          0          0          0          0          0          0         11          0 |        11 
-----------+---------------------------------------------------------------------------------------------------+----------
     Total |         6          5         10         29         25         22         19         11      1,727 |     1,854 

	 	 * 1727 perdidos son "1" en el algoritmo original. Por error en la sintaxis de C3 todos los perdidos se convierten en "1".
	     * 1 "0" es "1" en el algoritmo original por error en la sintaxis de C3 (los perdidos se convierten en "1")
		 * 1 "3" es "4" en el algoritmo original por error en la sintaxis de C3 (los perdidos se convierten en "1")
		 * 1 "5" es "6" en el algoritmo original por error en la sintaxis de C3 (los perdidos se convierten en "1")

*Have the person skipped the depression module?

* Revisión
*Nota. Se hace primero la versión revisada para no utilizar las variables SM_3 y SM4 modificadas.
gen d_skipped = 0
replace d_skipped = 1 if (SM_1==2 & SM_2==2 & SM_3==2) | (SM4==2 | SM4==9)
replace d_skipped = . if SM_1==. & SM_2==. & SM_3==. & SM4==.

* Original
egen serie_symp = rowtotal (SM8_1_alt-SM8_10_alt)
gen d_skipped_org = 0
recode SM_3 SM4 (1=1) (.=.) (else=0)
replace d_skipped_org = 1 if SM_3==0 | SM4==0 | (SM5==1 & SM6==4 & SM7==4) | serie_symp<2

tab d_skipped_org d_skipped, mis

d_skipped_ |            d_skipped
       org |         0          1          . |     Total
-----------+---------------------------------+----------
         0 |        88          0          0 |        88 
         1 |        39        991        736 |     1,766 
-----------+---------------------------------+----------
     Total |       127        991        736 |     1,854 
	 	 
		 * 39 "0" son "1" en el algoritmo original. 
		 * 736 perdidos son "1" en el algoritmo original. Corresponden a las personas que no participaron en el subestudio COVID (665), fueron proxy (62) o dejaron la entrevista a la mitad (n=9)
		 * (los otros 14 que dejaron la entrevista a medias sí comenzaron el módulo de salud mental y se les puede asignar un valor).
         * 39 "0" son "1" en el algoritmo original. Se trata de un error. Equipamos la sintaxis de salto sin considerar que los filtros eran distintos en cada cuestionario.
		 * De estos, 32 casos tenían SM_3==0, 4 tenían serie_symp<2 y 3 (SM5==1 & SM6==4 & SM7==4).
		 
***Severity of depressive episode

*To meet the criteria for "Mild depressive episode (F32.0)", at least two of the screening symptoms (B1-B3) must be present, and an additional symptom or symptoms from the rest of them (B1-C7) should be present to give a total of at least four. 
*In the case of "Moderate depressive episode (F32.1)", there must be at least two screening symptoms and a total of at least six symptoms. In the case of "Severe depressive episode (F32.3)", the three screening symptoms (B1-B3) must be present, and additional symptoms (C1-C7) should be present to give a total of at least eight.

* Original
gen d_30d_severity_org = .
replace d_30d_severity_org = 0 if (d_crit_a_org==0 | d_crit_b_org==0 | (d_screentotal_org==2 & d_symtotal_org<2) | (d_screentotal_org==3 & d_symtotal_org==0)) & ESTADO_ENTREVISTA==1
replace d_30d_severity_org = 1 if (d_crit_a_org==1 & ((d_screentotal_org==2 & d_symtotal_org>=2) | (d_screentotal_org==3 & d_symtotal_org>=1))) & ESTADO_ENTREVISTA==1
replace d_30d_severity_org = 2 if (d_crit_a_org==1 & ((d_screentotal_org==2 & d_symtotal_org>=4) | (d_screentotal_org==3 & d_symtotal_org>=3))) & ESTADO_ENTREVISTA==1
replace d_30d_severity_org = 3 if (d_crit_a_org==1 & (d_screentotal_org==3 & d_symtotal_org>=5)) & ESTADO_ENTREVISTA==1
label variable d_30d_severity_org "Severity of depressive episode (c2019_wCOVID)"
label define severity 0 "No" 1 "Mild" 2 "Moderate" 3 "Severe"
label values d_30d_severity_org severity

* Revisión
gen d_30d_severity = .
replace d_30d_severity = 0 if (d_crit_a==0 | d_crit_b==0 | (d_screentotal==2 & d_symtotal<2) | (d_screentotal==3 & d_symtotal==0)) 
replace d_30d_severity = 1 if (d_crit_a==1 & ((d_screentotal==2 & d_symtotal>=2) | (d_screentotal==3 & d_symtotal>=1))) 
replace d_30d_severity = 2 if (d_crit_a==1 & ((d_screentotal==2 & d_symtotal>=4) | (d_screentotal==3 & d_symtotal>=3))) 
replace d_30d_severity = 3 if (d_crit_a==1 & (d_screentotal==3 & d_symtotal>=5))
label variable d_30d_severity "Severity of depressive episode (c2019_wCOVID)"
label define severity 0 "No" 1 "Mild" 2 "Moderate" 3 "Severe"
label values d_30d_severity severity

tab d_30d_severity_org d_30d_severity, mis

  Severity |
        of |
depressive |
   episode |
(c2019_wCO |     Severity of depressive episode (c2019_wCOVID)
      VID) |        No       Mild   Moderate     Severe          . |     Total
-----------+-------------------------------------------------------+----------
        No |       993          0          0          0          0 |       993 
      Mild |         6         18          0          0          0 |        24 
  Moderate |         3          1         39          0          0 |        43 
    Severe |         0          0          1         43          0 |        44 
         . |        13          0          0          1        736 |       750 
-----------+-------------------------------------------------------+----------
     Total |     1,015         19         40         44        736 |     1,854 

		 * 6 "no" son "mild" en el algoritmo original. Esto se debe a las diferencias observadas en b1.
		 * 3 "no" son "moderate" en el algoritmo original. Esto se debe a las diferencias observadas en b1.
		 * 1 "mild" es "moderate" en el algoritmo original. Esto se debe a las diferencias observadas en b1.
		 * 1 "moderate" es "severe" en el algoritmo original. Esto se debe a las diferencias observadas en b1. 
		 * 13 "no" y 1 "severe" son perdidos en el algoritmo original. Se trata de 14 participantes con una entrevista abortada/rechazada a la mitad. No serán casos válidos en la variable final.
		 
***Depression in the previous 30 days 
* Original
gen depression_30d_org= .
replace depression_30d_org = 1 if d_30d_severity_org >=1 & ESTADO_ENTREVISTA==1 
replace depression_30d_org = 0 if (d_30d_severity_org ==0 | d_skipped_org==1) & ESTADO_ENTREVISTA==1 
label variable depression_30d_org "30 days depression (c2019_wCOVID)"

* Revisión
gen depression_30d= .
replace depression_30d = 1 if (d_30d_severity >=1 & d_30d_severity<.) & ESTADO_ENTREVISTA==1
replace depression_30d = 0 if (d_30d_severity ==0 | d_skipped==1) & ESTADO_ENTREVISTA==1
label variable depression_30d "30 days depression (c2019_wCOVID)"

tab depression_30d_org depression_30d, mis

   30 days |
depression |        30 days depression
(c2019_wCO |          (c2019_wCOVID)
      VID) |         0          1          . |     Total
-----------+---------------------------------+----------
         0 |       996         21          0 |     1,017 
         1 |         6         81          0 |        87 
         . |         0          0        750 |       750 
-----------+---------------------------------+----------
     Total |     1,002        102        750 |     1,854 

		 * 6 "0" son "1" en el algoritmo original. Esto es debido a las diferencias observadas en b1.
		 * 21 "1" son "0" en el algoritmo original. 19 casos se perdieron por SM3==0 en d_skipped y 2 casos se perdieron por (SM5==1 & SM6==4 & SM7==4) en d_skipped.
		 * Los 750 perdidos responden a entrevistas no realizadas, abortadas a la mitad o entrevistas proxy.
		 * El algoritmo final no parece verse afectado por el error en C3, puesto que son casos con d_skipped==1.
```

```{stata descriptives, collectcode=FALSE, results='markup', echo=TRUE}

```

```{stata save-data}
keep ID_ECS ESTADO_ENTREVISTA depression_30d d_30d_severity

*Cohorte 2019, ola postconfinamiento:
*saveold "~\UAM\marta.miret@uam.es - Documentacion Edad con Salud\Edad con salud - Subestudio COVID\Outcomes\Outcome datasets\Outcome_depression_ICD10.dta", replace version(13)

```

# Contact person:

- Name: Natalia Martín (adapted the algorithm for the COVID-19 substudy)
- e-mail: [natalia.martinm@uam.es](mailto:natalia.martinm@uam.es){.email}

<br>

- Name: Elvira Lara (updated the algorithm)
- e-mail: [elvira.lara\@uam.es](mailto:elvira.lara@uam.es){.email}
- Phone number: (+34) 914974601

<br>
  
Original version:
  
- Name: Félix Caballero 
- e-mail: [felix.caballero@uam.es](mailto:felix.caballero@uam.es){.email}

# References

:::{#refs}
World Health Organization. (1993). The ICD-10 classification of mental and behavioural disorders: diagnostic criteria for research. Ed. World Health Organization: Geneva.
:::

# Session info

```{r, results='markup'}
devtools::session_info()
```
